runcmd:
 - snap install helm --classic
 - echo 'alias kc="kubectl"' >> /home/.bashrc
 - echo 'source <(kubectl completion bash)' >> /home/.bashrc
 - echo 'complete -F __start_kubectl kc' >> /home/.bashrc
 - echo 'export KUBECONFIG=/etc/rancher/k3s/k3s.yaml' >> /home/.bashrc
 - cat /home/.bashrc >> /home/ubuntu/.bashrc
 - chown -R ubuntu:ubuntu /home/install.sh
 - rm -Rf /home/.bashrc
 - mv /home/install.sh /home/ubuntu/
 - /home/ubuntu/install.sh
 

write_files:
- encoding: b64
  content: IyEvYmluL2Jhc2gKCmV4cG9ydCAkKGNhdCAvZW52IHwgeGFyZ3MpCgojIHN0YXJ0IGszcyBhbmQgd2FpdCBmb3IgcG9kIHRvIGJlIHVwCmN1cmwgLXNmTCBodHRwczovL2dldC5rM3MuaW8gfCBzaCAtcyAtIC0tZGlzYWJsZSB0cmFlZmlrIC0td3JpdGUta3ViZWNvbmZpZy1tb2RlPTY0NAplY2hvICJ3YWl0aW5nIGZvciBrM3MiCgp3aGlsZSAhIGt1YmVjdGwgd2FpdCAtLWZvcj1jb25kaXRpb249cmVhZHkgLW4ga3ViZS1zeXN0ZW0gcG9kIC1sIGs4cy1hcHA9bWV0cmljcy1zZXJ2ZXIKZG8KICAgIGVjaG8gIndhaXRpbmcgZm9yIGszcyBwb2RzIgogICAgc2xlZXAgMQpkb25lCgojIGtuYXRpdmUKa3ViZWN0bCBhcHBseSAtZiBodHRwczovL2dpdGh1Yi5jb20va25hdGl2ZS9vcGVyYXRvci9yZWxlYXNlcy9kb3dubG9hZC9rbmF0aXZlLXYxLjEyLjIvb3BlcmF0b3IueWFtbAprdWJlY3RsIGNyZWF0ZSBucyBrbmF0aXZlLXNlcnZpbmcKCmlmIFsgLW4gIiR7SFRUUFNfUFJPWFkrMX0iIF07IHRoZW4KICBlY2hvICJhZGRpbmcgcHJveHkgdG8ga25hdGl2ZSIKICBjdXJsIGh0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS9kaXJla3Rpdi9kaXJla3Rpdi9tYWluL3NjcmlwdHMva3ViZXJuZXRlcy9pbnN0YWxsL2tuYXRpdmUvYmFzaWMueWFtbCA+IGtuYXRpdmUueWFtbAoKICBsbj0kKGF3ayAnL25hbWU6IGNvbnRyb2xsZXIvIHtwcmludCBGTlJ9JyBrbmF0aXZlLnlhbWwpCiAgbnVtPSQoKGxuICsgMSkpCgogIFZBUj0kKGNhdCA8PC1FTkQKICAgIGVudjoKICAgICAgLSBjb250YWluZXI6IGNvbnRyb2xsZXIKICAgICAgICBlbnZWYXJzOgogICAgICAgIC0gbmFtZTogSFRUUF9QUk9YWQogICAgICAgICAgdmFsdWU6ICIke0hUVFBfUFJPWFl9IgogICAgICAgIC0gbmFtZTogSFRUUFNfUFJPWFkKICAgICAgICAgIHZhbHVlOiAiJHtIVFRQX1BST1hZfSIKICAgICAgICAtIG5hbWU6IE5PX1BST1hZCiAgICAgICAgICB2YWx1ZTogIiR7Tk9fUFJPWFl9IgpFTkQKKQoKICAgIGVkIC12IGtuYXRpdmUueWFtbCA8PEVORAoke251bX1pCiR7VkFSfQouCncKcQpFTkQKCiAga3ViZWN0bCBhcHBseSAtZiBrbmF0aXZlLnlhbWwKZWxzZQogIGt1YmVjdGwgYXBwbHkgLWYgaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL2RpcmVrdGl2L2RpcmVrdGl2L21haW4vc2NyaXB0cy9rdWJlcm5ldGVzL2luc3RhbGwva25hdGl2ZS9iYXNpYy55YW1sCmZpCgojIGRhdGFiYXNlCm1rZGlyIHB2CmNhdCA8PEVPRiA+IHB2L3B2LnlhbWwKYXBpVmVyc2lvbjogYXBwcy92MQpraW5kOiBEZXBsb3ltZW50Cm1ldGFkYXRhOgogIG5hbWU6IHBvc3RncmVzCnNwZWM6CiAgcmVwbGljYXM6IDEKICBzZWxlY3RvcjoKICAgIG1hdGNoTGFiZWxzOgogICAgICBhcHA6IHBvc3RncmVzCiAgdGVtcGxhdGU6CiAgICBtZXRhZGF0YToKICAgICAgbGFiZWxzOgogICAgICAgIGFwcDogcG9zdGdyZXMKICAgIHNwZWM6CiAgICAgIHZvbHVtZXM6CiAgICAgICAgLSBuYW1lOiBwb3N0Z3Jlcy1wdi1zdG9yYWdlCiAgICAgICAgICBwZXJzaXN0ZW50Vm9sdW1lQ2xhaW06CiAgICAgICAgICAgIGNsYWltTmFtZTogcG9zdGdyZXMtcHYtY2xhaW0KICAgICAgY29udGFpbmVyczoKICAgICAgICAtIG5hbWU6IHBvc3RncmVzCiAgICAgICAgICBpbWFnZTogcG9zdGdyZXM6MTMuNAogICAgICAgICAgaW1hZ2VQdWxsUG9saWN5OiBJZk5vdFByZXNlbnQKICAgICAgICAgIHBvcnRzOgogICAgICAgICAgICAtIGNvbnRhaW5lclBvcnQ6IDU0MzIKICAgICAgICAgIGVudjoKICAgICAgICAgICAgLSBuYW1lOiBQT1NUR1JFU19VU0VSCiAgICAgICAgICAgICAgdmFsdWU6IGRpcmVrdGl2CiAgICAgICAgICAgIC0gbmFtZTogUE9TVEdSRVNfREIKICAgICAgICAgICAgICB2YWx1ZTogZGlyZWt0aXYKICAgICAgICAgICAgLSBuYW1lOiBQT1NUR1JFU19QQVNTV09SRAogICAgICAgICAgICAgIHZhbHVlOiBkaXJla3RpdmRpcmVrdGl2CiAgICAgICAgICAgIC0gbmFtZTogUEdEQVRBCiAgICAgICAgICAgICAgdmFsdWU6IC92YXIvbGliL3Bvc3RncmVzcWwvZGF0YS9wZ2RhdGEKICAgICAgICAgIHZvbHVtZU1vdW50czoKICAgICAgICAgICAgLSBtb3VudFBhdGg6IC92YXIvbGliL3Bvc3RncmVzcWwvZGF0YQogICAgICAgICAgICAgIG5hbWU6IHBvc3RncmVzLXB2LXN0b3JhZ2UKRU9GCgpjYXQgPDxFT0YgPiBwdi9zdG9yYWdlLnlhbWwKYXBpVmVyc2lvbjogdjEKa2luZDogUGVyc2lzdGVudFZvbHVtZQptZXRhZGF0YToKICBuYW1lOiBwb3N0Z3Jlcy1wdi12b2x1bWUKc3BlYzoKICBzdG9yYWdlQ2xhc3NOYW1lOiBsb2NhbC1wYXRoCiAgY2FwYWNpdHk6CiAgICBzdG9yYWdlOiAxR2kKICBhY2Nlc3NNb2RlczoKICAgIC0gUmVhZFdyaXRlT25jZQogIGhvc3RQYXRoOgogICAgcGF0aDogIi90bXAvcGdkYXRhIgotLS0KYXBpVmVyc2lvbjogdjEKa2luZDogUGVyc2lzdGVudFZvbHVtZUNsYWltCm1ldGFkYXRhOgogIG5hbWU6IHBvc3RncmVzLXB2LWNsYWltCnNwZWM6CiAgc3RvcmFnZUNsYXNzTmFtZTogbG9jYWwtcGF0aAogIGFjY2Vzc01vZGVzOgogICAgLSBSZWFkV3JpdGVPbmNlCiAgcmVzb3VyY2VzOgogICAgcmVxdWVzdHM6CiAgICAgIHN0b3JhZ2U6IDFHaQotLS0KYXBpVmVyc2lvbjogdjEKa2luZDogU2VydmljZQptZXRhZGF0YToKICBuYW1lOiBwb3N0Z3JlcwogIGxhYmVsczoKICAgIGFwcDogcG9zdGdyZXMKc3BlYzoKICB0eXBlOiBDbHVzdGVySVAKICBwb3J0czoKICAgLSBwb3J0OiA1NDMyCiAgc2VsZWN0b3I6CiAgICBhcHA6IHBvc3RncmVzCkVPRgoKa3ViZWN0bCBhcHBseSAtZiBwdgoKIyBkb2NrZXIgcmVnaXN0cnkKbWtkaXIgcmVnaXN0cnkKCmNhdCA8PEVPRiA+IHJlZ2lzdHJ5L3JlZ2lzdHJ5LnlhbWwKYXBpVmVyc2lvbjogdjEKa2luZDogTmFtZXNwYWNlCm1ldGFkYXRhOgogIG5hbWU6IHJlZ2lzdHJ5LW5zCi0tLQphcGlWZXJzaW9uOiB2MQpraW5kOiBTZXJ2aWNlQWNjb3VudAptZXRhZGF0YToKICBuYW1lOiByZWdpc3RyeS1zYQogIG5hbWVzcGFjZTogcmVnaXN0cnktbnMKLS0tCmFwaVZlcnNpb246IHYxCmtpbmQ6IFBvZAptZXRhZGF0YToKICBuYW1lOiBkb2NrZXItcmVnaXN0cnktcG9kCiAgbmFtZXNwYWNlOiByZWdpc3RyeS1ucwogIGxhYmVsczoKICAgIGFwcDogcmVnaXN0cnkKc3BlYzoKICBzZXJ2aWNlQWNjb3VudE5hbWU6IHJlZ2lzdHJ5LXNhCiAgY29udGFpbmVyczoKICAtIG5hbWU6IHJlZ2lzdHJ5CiAgICBpbWFnZTogcmVnaXN0cnk6Mi43LjEKLS0tCmFwaVZlcnNpb246IHYxCmtpbmQ6IFNlcnZpY2UKbWV0YWRhdGE6CiAgbmFtZTogZG9ja2VyLXJlZ2lzdHJ5CiAgbmFtZXNwYWNlOiByZWdpc3RyeS1ucwpzcGVjOgogIHR5cGU6IE5vZGVQb3J0CiAgc2VsZWN0b3I6CiAgICBhcHA6IHJlZ2lzdHJ5CiAgcG9ydHM6CiAgLSBwb3J0OiA1MDAwCiAgICB0YXJnZXRQb3J0OiA1MDAwCiAgICBub2RlUG9ydDogMzEyMTIKRU9GCgprdWJlY3RsIGFwcGx5IC1mIHJlZ2lzdHJ5CgojIHdhaXRpbmcgZm9yIGRiCndoaWxlICEga3ViZWN0bCB3YWl0IC0tZm9yPWNvbmRpdGlvbj1yZWFkeSBwb2QgLWwgYXBwPXBvc3RncmVzCmRvCiAgICBlY2hvICJ3YWl0aW5nIGZvciBkYXRhYmFzZSIKICAgIHNsZWVwIDEKZG9uZQoKCiMgZGlyZWt0aXYKY2F0IDw8RU9GID4gZGlyZWt0aXYueWFtbApwdWxsUG9saWN5OiBJZk5vdFByZXNlbnQKZGVidWc6ICJ0cnVlIgoKZXZlbnRpbmc6CiAgZW5hYmxlZDogdHJ1ZQoKJChpZiBbIC1uICIke0hUVFBTX1BST1hZKzF9IiBdOyB0aGVuCiAgZWNobyAiICBodHRwX3Byb3h5OiAke0hUVFBfUFJPWFl9IgogIGVjaG8gIiAgaHR0cHNfcHJveHk6ICR7SFRUUFNfUFJPWFl9IgogIGVjaG8gIiAgbm9fcHJveHk6ICR7Tk9fUFJPWFl9IgpmaSkKCmRhdGFiYXNlOgogICMgLS0gZGF0YWJhc2UgaG9zdAogIGhvc3Q6ICJwb3N0Z3JlcyIKICAjIC0tIGRhdGFiYXNlIHBvcnQKICBwb3J0OiA1NDMyCiAgIyAtLSBkYXRhYmFzZSB1c2VyCiAgdXNlcjogImRpcmVrdGl2IgogICMgLS0gZGF0YWJhc2UgcGFzc3dvcmQKICBwYXNzd29yZDogImRpcmVrdGl2ZGlyZWt0aXYiCiAgIyAtLSBkYXRhYmFzZSBuYW1lLCBhdXRvIGNyZWF0ZWQgaWYgaXQgZG9lcyBub3QgZXhpc3QKICBuYW1lOiAiZGlyZWt0aXYiCiAgIyAtLSBzc2xtb2RlIGZvciBkYXRhYmFzZQogIHNzbG1vZGU6IGRpc2FibGUKCiQoaWYgWyAtbiAiJHtIVFRQU19QUk9YWSsxfSIgXTsgdGhlbgogIGVjaG8gImh0dHBfcHJveHk6ICR7SFRUUF9QUk9YWX0iCiAgZWNobyAiaHR0cHNfcHJveHk6ICR7SFRUUFNfUFJPWFl9IgogIGVjaG8gIm5vX3Byb3h5OiAke05PX1BST1hZfSIKZmkpCgokKGlmIFsgLW4gIiR7QVBJS0VZKzF9IiBdOyB0aGVuCiAgZWNobyAiYXBpa2V5OiBcIiR7QVBJS0VZfVwiIgpmaSkKRU9GCgpoZWxtIHJlcG8gYWRkIGRpcmVrdGl2IGh0dHBzOi8vY2hhcnQuZGlyZWt0aXYuaW8gJiYgXApoZWxtIHJlcG8gYWRkIGluZ3Jlc3MtbmdpbnggaHR0cHM6Ly9rdWJlcm5ldGVzLmdpdGh1Yi5pby9pbmdyZXNzLW5naW54ICYmIFwKaGVsbSByZXBvIGFkZCBwcm9tZXRoZXVzIGh0dHBzOi8vcHJvbWV0aGV1cy1jb21tdW5pdHkuZ2l0aHViLmlvL2hlbG0tY2hhcnRzICYmIFwKS1VCRUNPTkZJRz0vZXRjL3JhbmNoZXIvazNzL2szcy55YW1sIGhlbG0gaW5zdGFsbCAtZiAvZGlyZWt0aXYueWFtbCBkaXJla3RpdiBkaXJla3Rpdi9kaXJla3RpdgoKIyBldmVudGluZwprdWJlY3RsIGNyZWF0ZSBucyBrbmF0aXZlLWV2ZW50aW5nCgpjYXQgPDxFT0YgPiBldmVudGluZy55YW1sCmFwaVZlcnNpb246IG9wZXJhdG9yLmtuYXRpdmUuZGV2L3YxYmV0YTEKa2luZDogS25hdGl2ZUV2ZW50aW5nCm1ldGFkYXRhOgogIG5hbWU6IGtuYXRpdmUtZXZlbnRpbmcKICBuYW1lc3BhY2U6IGtuYXRpdmUtZXZlbnRpbmcKRU9GCgprdWJlY3RsIGFwcGx5IC1mIGV2ZW50aW5nLnlhbWwKCiMgY29udG91cgprdWJlY3RsIGFwcGx5IC0tZmlsZW5hbWUgaHR0cHM6Ly9naXRodWIuY29tL2tuYXRpdmUvbmV0LWNvbnRvdXIvcmVsZWFzZXMvZG93bmxvYWQva25hdGl2ZS12MS4xMi4yL2NvbnRvdXIueWFtbAprdWJlY3RsIGRlbGV0ZSBucyBjb250b3VyLWV4dGVybmFsICYKCiMgd2FpdGluZyBmb3IgZGlyZWt0aXYKd2hpbGUgISBrdWJlY3RsIHdhaXQgLS1mb3I9Y29uZGl0aW9uPXJlYWR5IHBvZCAtbCBhcHAua3ViZXJuZXRlcy5pby9uYW1lPWRpcmVrdGl2CmRvCiAgICBlY2hvICJ3YWl0aW5nIGZvciBkaXJla3RpdiIKICAgIHNsZWVwIDEKZG9uZQoKbj0wCnVudGlsIFsgIiRuIiAtZ2UgMjQgXQpkbwogICBjdXJsIC1YIFBVVCBodHRwOi8vbG9jYWxob3N0L2FwaS9uYW1lc3BhY2VzL2V4YW1wbGVzIFwKICAgICAtSCAiQ29udGVudC1UeXBlOiBhcHBsaWNhdGlvbi9qc29uIiBcCiAgICAgLUggIkRpcmVrdGl2LVRva2VuOiAke0FQSUtFWX0iIFwKICAgICAtLXdyaXRlLW91dCAiJXtodHRwX2NvZGV9IiBcCiAgICAgLWYgXAogICAgIC1kICd7ICJ1cmwiOiAiaHR0cHM6Ly9naXRodWIuY29tL2RpcmVrdGl2L2RpcmVrdGl2LWV4YW1wbGVzLmdpdCIsICJyZWYiOiAibWFpbiIgfScgJiYgYnJlYWsKICAgbj0kKChuKzEpKQogICBzbGVlcCAxMApkb25lCgoKCg==
  path: /home/install.sh
  permissions: '0755'