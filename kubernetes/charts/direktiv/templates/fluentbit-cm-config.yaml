apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "direktiv.fullname" . }}-config-fluentbit
  labels:
    {{- include "direktiv.labels" . | nindent 4 }}
data:
  fluentbit.cfg: |
    [SERVICE]
        Flush           5
        Daemon          off
        Log_Level       info

    [OUTPUT]
        Name          pgsql
        Match         functions
        Host          {{ .Values.database.host }}
        Port          {{ .Values.database.port }}
        User          {{ .Values.database.user }}
        Password      {{ .Values.database.password }}
        Database      {{ .Values.database.name }}
        Timestamp_Key ts

    [INPUT]
        name    http
        host    0.0.0.0
        port    8888
        tag     functions

    [INPUT]
        name  http
        host  0.0.0.0
        port  8889
        tag   application

    {{ .Values.fluentbit.extraConfig | nindent 4 }}
