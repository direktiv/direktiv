apiVersion: batch/v1beta1
kind: CronJob
metadata:
  name: backupdb
  annotations:
    linkerd.io/inject: disabled
spec:
  schedule: '* * * * *'
  jobTemplate:
    spec:
      template:
        metadata:
          annotations:
            linkerd.io/inject: disabled
        spec:
          containers:
            - name: hello
              image: 'localhost:5000/backup'
              imagePullPolicy: IfNotPresent
              env:
                - name: PGPASSWORD
                  value: yugabyte # change yugabyte pwd here and add additional commands. the example is bad btw :)
              command:
                - /bin/sh
                - '-c'
                - >-
                  date; echo "backup start";
                  /yugabyte-2.9.0.0/postgres/bin/ysql_dump -d direktiv -h
                  yb-tservers.yugabyte > /tmp/data.sql; ls -la /tmp;
                  apt install -y sshpass;
                  sshpass -p "mypwd" scp -o StrictHostKeyChecking=no /tmp/data.sql username@192.168.0.1:/tmp/data.sql;
                  echo "copied"
          restartPolicy: Never
