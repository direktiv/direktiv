
/api/v2/namespaces/{namespace}/files/{path}:
  get:
    tags:
      - files
    summary: Read any node in the filesystem tree
    # description:
    parameters:
      - $ref: '../parameters.yaml#/namespace'
      - name: path
        in: path
        schema:
          type: string
          description: path of the node to read (with slashes)
        required: true
    responses:
      "200":
        description: filesystem tree node data
        content:
          application/json:
            schema:
              type: object
              properties:
                data:
                  type: object
                  allOf: # Combines the BasicErrorModel and the inline model
                    - $ref: '../objects.yaml#/FileNodeWithoutData'
                    - type: object
                      description: files node data
                      properties:
                        data:
                          type: string
                          description: (only with type != directory) base64 encoded string of the file content
                        children:
                          type: array
                          description: list of files child nodes
                          items:
                            $ref: '../objects.yaml#/FileNodeWithoutData'

  delete:
    tags:
      - files
    summary: Delete any node in the filesystem tree
    # description:
    parameters:
      - $ref: '../parameters.yaml#/namespace'
      - name: path
        in: path
        schema:
          type: string
          description: path of the node to delete (with slashes)
        required: true
    responses:
      "200":
        description: filesystem tree node deleted successfully


  post:
    tags:
      - files
    summary: Create a node in the filesystem tree
    # description:
    parameters:
      - $ref: '../parameters.yaml#/namespace'
      - name: path
        in: path
        schema:
          type: string
          description: path of the parent node (with slashes)
        required: true
    requestBody:
      description: User data
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
             name:
               type: string
               description: name of the node(file or directory name)
             type:
               type: string
               enum: [ directory, file, workflow, service, endpoint, consumer ]
               description: type of the node
             mimeType:
               type: string
               description: (only with type != directory) mime type of the file content
             data:
               type: string
               description: (only with type != directory) base64 encoded string of the file content

    responses:
      "200":
        description: filesystem tree node created successfully
        content:
          application/json:
            schema:
              type: object
              properties:
                data:
                  type: object
                  $ref: '../objects.yaml#/FileNodeWithoutData'

  patch:
    tags:
      - files
    summary: Update a node in the filesystem tree (change path or data)
    # description:
    parameters:
      - $ref: '../parameters.yaml#/namespace'
      - name: path
        in: path
        schema:
          type: string
          description: path of the parent node (with slashes)
        required: true
    requestBody:
      description: User data
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              path:
                type: string
                description: the new absolute path of the node(file or directory name)
              data:
                type: string
                description: (only with type != directory) base64 encoded string of the file content
    responses:
      "200":
        description: filesystem tree node updated successfully
        content:
          application/json:
            schema:
              type: object
              allOf: # Combines the BasicErrorModel and the inline model
                - $ref: '../objects.yaml#/FileNodeWithoutData'
                - type: object
                  description: files node data
                  properties:
                    data:
                      type: string
                      description: (only with type != directory) base64 encoded string of the file content
/api/v2/namespaces/{namespace}/gateway/consumers:
  get:
    tags:
      - gateway
    summary: Get all consumers
    parameters:
      - $ref: '../parameters.yaml#/namespace'
    responses:
      "200":
        description: Consumers for gateway in the namespace
        content:
          application/json:
            schema:
              type: object
              properties:
                data:
                  type: array
                  items:
                    type: object
                    properties:
                      username:
                        type: string
                        description: unique username
                      password:
                        type: string
                        description: password for basic authentication
                      api_key:
                        type: string
                        description: api key for the user
                      tags:
                        type: array
                        nullable: true
                        items:
                          type: string
                          description: tag identifier
                      groups:
                        type: array
                        nullable: true
                        items:
                          type: string
                          description: group identifier

/api/v2/namespaces/{namespace}/gateway/routes:
  get:
    tags:
      - gateway
    summary: Get all routes
    parameters:
      - $ref: '../parameters.yaml#/namespace'
      - in: query
        name: path
        schema:
          type: string
        description: Filter result by path string
    responses:
      "200":
        description: Routes for gateway in the namespace
        content:
          application/json:
            schema:
              type: object
              properties:
                data:
                  type: array
                  items:
                    $ref: '../objects.yaml#/route'
/api/v2/namespaces/{namespace}/logs:
  get:
    tags:
    - plattformlogs
    summary: Api for listing the last 200 log entries for a given resource.
    parameters:
      - name: namespace
        in: path
        required: true
        schema:
            type: string
            pattern: '^(([a-z][a-z0-9_\-\.]*[a-z0-9])|([a-z]))$'
        style: simple
      - name: instance
        in: query
        required: false
        schema:
          type: string
          format: uuid
      - name: route
        in: query
        required: false
        schema:
          type: string
      - name: activity
        in: query
        required: false
        schema:
          type: string
          format: uuid
      - name: trace
        in: query
        required: false
        schema:
          type: string
      - name: before
        in: query
        required: false
        description: Optional argument for using to request logs older then the given time.
        schema: 
          type: string 
          format: RFC3339Nano
    responses:
      '200':
        description: OK
        content:
          'application/json':
            example:
              nextPage: '2024-01-17T01:44:08.128136Z'
              data:
              - time: '2024-01-17T01:44:08.128136Z'
                level: 'error'
                msg: 'Pungin xy failed.'
                trace: "00000000000000000000000000000000"
                branch: 1
                state: "noop"
            schema:
              type: object
              properties:
                pageInfo:
                  type: object 
                  properties:
                    next:
                      type: string
                      format: RFC3339Nano
                data:
                  type: array
                  items: 
                    type: object
                    properties:
                      time: 
                        type: string 
                        format: RFC3339Nano
                      level: 
                        type: string 
                        enum: ["info", "error"]
                      msg: 
                        type: string
/api/v2/namespaces/{namespace}/logs/subscribe:
  get:
    tags:
    - plattformlogs
    summary: Api for SSE streaming of incoming logs stating the systems current time.
    parameters:
      - name: namespace
        in: path
        required: true
        schema:
            type: string
            pattern: '^(([a-z][a-z0-9_\-\.]*[a-z0-9])|([a-z]))$'
        style: simple
      - name: instance
        in: query
        required: false
        schema:
          type: string
          format: uuid
      - name: route
        in: query
        required: false
        schema:
          type: string
      - name: activity
        in: query
        required: false
        schema:
          type: string
          format: uuid
      - name: trace
        in: query
        required: false
        schema:
          type: string
      - name: Last-Event-ID
        in: header
        required: false
        schema:
          type: string
    responses:
      '200':
        description: OK
        content:
          text/event-stream:
            example: |
              id: 4
              event: message
              data: {'id':'4','time':'2024-02-07T08:59:52.666925Z','msg':'Starting workflow /action.yaml','level':'INFO'}
              
              id: 6
              event: message
              data: {'id':'6','time':'2024-02-07T09:00:01.770604Z','msg':'Workflow /action.yaml completed.','level':'INFO'}
/api/v2/namespaces/{namespace}/registries:
  get:
    tags:
      - registries
    summary: Get all namespace registries
    # description:
    parameters:
      - $ref: '../parameters.yaml#/namespace'
    responses:
      "200":
        description: Registries list returned
        content:
          application/json:
            schema:
              type: object
              properties:
                data:
                  type: array
                  items:
                    type: object
                    properties:
                      id:
                        type: string
                        description: a unique string that represent id of the registry
                      namespace:
                        type: string
                        description: the namespace of registry belongs
                      url:
                        type: string
                        description: url of the registry
                      user:
                        type: string
                        description: anonymize username of the registry

  post:
    tags:
      - registries
    summary: Create a new registry secret
    requestBody:
      description: User data
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              url:
                type: string
                description: url of the registry
              user:
                type: string
                description: username of the registry
              password:
                type: string
                description: password string
    responses:
      "200":
        description: Created registry object returned
        content:
          application/json:
            schema:
              type: object
              properties:
                id:
                  type: string
                  description: a unique string that represent id of the registry
                namespace:
                  type: string
                  description: the namespace of registry belongs
                url:
                  type: string
                  description: url of the registry
                user:
                  type: string
                  description: anonymize username of the registry

/api/v2/namespaces/{namespace}/registries/{registryID}:
  delete:
    tags:
      - registries
    summary: Remove a registry secret
    parameters:
      - $ref: '../parameters.yaml#/registryID'
    responses:
      "200":
        description:  Registry object deleted
/api/v2/namespaces/{namespace}/services:
  get:
    tags:
      - services
    summary: Get all services
    # description:
    parameters:
      - $ref: '../parameters.yaml#/namespace'
    responses:
      "200":
        description: Services list returned
        content:
          application/json:
            schema:
              type: object
              properties:
                data:
                  type: array
                  items:
                    type: object
                    properties:
                      id:
                        type: string
                        description: a unique string that represent id of the service
                      type:
                        type: string
                        description: enum value ("workflow-service" or "namespace-service")
                      namespace:
                        type: string
                        description: the namespace of service belongs
                      name:
                        type: string
                        description: name of the service
                      filePath:
                        type: string
                        description: file path where this service is defined
                      image:
                        type: string
                        description: docker image of the service
                      cmd:
                        type: string
                        description: docker command
                      size:
                        type: string
                        description: can be 'large', 'medium' or 'small'
                      scale:
                        type: integer
                        description: number from 0 to 9
                      error:
                        type: [ string, null ]
                        description: error string when service failed to be scheduled, otherwise null
                      envs:
                        type: array
                        nullable: false
                        description: environment variables used to exec the service
                        items:
                          type: object
                          properties:
                            name:
                              type: string
                              description: name of the variable
                            value:
                              type: string
                              description: value of the variable
                      conditions:
                        type: array
                        nullable: true
                        description: list of checks indicating the health checks of the service, null value means the service is not scheduled yet
                        items:
                          type: object
                          properties:
                            type:
                              type: string
                              description: name of the check
                            status:
                              type: string
                              description: can be 'True', 'False' or 'Unknown'
                            message:
                              type: string
                              description: human readable message about the reason of this condition - can be empty

/api/v2/namespaces/{namespace}/services/{serviceID}/pods:
  get:
    tags:
      - services
    summary: Get all pods for a given service
    # description:
    parameters:
      - $ref: '../parameters.yaml#/namespace'
      - $ref: '../parameters.yaml#/serviceID'
    responses:
      "200":
        description: Pods list returned
        content:
          application/json:
            schema:
              type: object
              properties:
                data:
                  type: array
                  items:
                    type: object
                    properties:
                      id:
                        type: string
                        description: a unique string that represent id of the pod

/api/v2/namespaces/{namespace}/services/{serviceID}/pods/{podID}/logs:
  get:
    tags:
      - services
    summary: Stream logs for a given pod
    # description:
    parameters:
      - $ref: '../parameters.yaml#/namespace'
      - $ref: '../parameters.yaml#/serviceID'
      - $ref: '../parameters.yaml#/podID'
    responses:
      "200":
        description: Stream of plain text log data

/api/v2/namespaces/{namespace}/services/{serviceID}/actions/rebuild:
  post:
    tags:
      - services
    summary:  Rebuilds service
    # description:
    parameters:
      - $ref: '../parameters.yaml#/namespace'
      - $ref: '../parameters.yaml#/serviceID'
    responses:
      "200":
        description: Service rebuilds successfully

/api/v2/version:
  get:
    summary: Get server version information.
    tags:
    - server
    responses:
      '200': 
        description: Server version information.
        content:
          application/json:
            example:
              data: "1.0.0"
            schema:
              type: object
              properties:
                data: 
                  type: string
