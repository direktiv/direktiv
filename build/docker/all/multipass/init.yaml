runcmd:
 - snap install helm --classic
 - echo 'alias kc="kubectl"' >> /home/.bashrc
 - echo 'source <(kubectl completion bash)' >> /home/.bashrc
 - echo 'complete -F __start_kubectl kc' >> /home/.bashrc
 - echo 'export KUBECONFIG=/etc/rancher/k3s/k3s.yaml' >> /home/.bashrc
 - cat /home/.bashrc >> /home/ubuntu/.bashrc
 - chown -R ubuntu:ubuntu /home/install.sh
 - rm -Rf /home/.bashrc
 - mv /home/install.sh /home/ubuntu/
 - /home/ubuntu/install.sh direktiv/direktiv direktiv/ui dev
 

write_files:
- encoding: b64
  content: IyEvYmluL2Jhc2gKCmV4cG9ydCAkKGNhdCAvZW52IHwgeGFyZ3MpCgojIHN0YXJ0IGszcyBhbmQgd2FpdCBmb3IgcG9kIHRvIGJlIHVwCmN1cmwgLXNmTCBodHRwczovL2dldC5rM3MuaW8gfCBzaCAtcyAtIC0tZGlzYWJsZSB0cmFlZmlrIC0td3JpdGUta3ViZWNvbmZpZy1tb2RlPTY0NAplY2hvICJ3YWl0aW5nIGZvciBrM3MiCgp3aGlsZSAhIGt1YmVjdGwgd2FpdCAtLWZvcj1jb25kaXRpb249cmVhZHkgLW4ga3ViZS1zeXN0ZW0gcG9kIC1sIGs4cy1hcHA9bWV0cmljcy1zZXJ2ZXIKZG8KICAgIGVjaG8gIndhaXRpbmcgZm9yIGszcyBwb2RzIgogICAgc2xlZXAgMQpkb25lCgojIGtuYXRpdmUKa3ViZWN0bCBhcHBseSAtZiBodHRwczovL2dpdGh1Yi5jb20va25hdGl2ZS9vcGVyYXRvci9yZWxlYXNlcy9kb3dubG9hZC9rbmF0aXZlLXYxLjkuNC9vcGVyYXRvci55YW1sCmt1YmVjdGwgY3JlYXRlIG5zIGtuYXRpdmUtc2VydmluZwoKaWYgWyAtbiAiJHtIVFRQU19QUk9YWSsxfSIgXTsgdGhlbgogIGVjaG8gImFkZGluZyBwcm94eSB0byBrbmF0aXZlIgogIGN1cmwgaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL2RpcmVrdGl2L2RpcmVrdGl2L21haW4va3ViZXJuZXRlcy9pbnN0YWxsL2tuYXRpdmUvYmFzaWMueWFtbCA+IGtuYXRpdmUueWFtbAoKICBsbj0kKGF3ayAnL25hbWU6IGNvbnRyb2xsZXIvIHtwcmludCBGTlJ9JyBrbmF0aXZlLnlhbWwpCiAgbnVtPSQoKGxuICsgMSkpCgogIFZBUj0kKGNhdCA8PC1FTkQKICAgIGVudjoKICAgICAgLSBjb250YWluZXI6IGNvbnRyb2xsZXIKICAgICAgICBlbnZWYXJzOgogICAgICAgIC0gbmFtZTogSFRUUF9QUk9YWQogICAgICAgICAgdmFsdWU6ICIke0hUVFBfUFJPWFl9IgogICAgICAgIC0gbmFtZTogSFRUUFNfUFJPWFkKICAgICAgICAgIHZhbHVlOiAiJHtIVFRQX1BST1hZfSIKICAgICAgICAtIG5hbWU6IE5PX1BST1hZCiAgICAgICAgICB2YWx1ZTogIiR7Tk9fUFJPWFl9IgpFTkQKKQoKICAgIGVkIC12IGtuYXRpdmUueWFtbCA8PEVORAoke251bX1pCiR7VkFSfQouCncKcQpFTkQKCiAga3ViZWN0bCBhcHBseSAtZiBrbmF0aXZlLnlhbWwKZWxzZQogIGt1YmVjdGwgYXBwbHkgLWYgaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL2RpcmVrdGl2L2RpcmVrdGl2L21haW4va3ViZXJuZXRlcy9pbnN0YWxsL2tuYXRpdmUvYmFzaWMueWFtbApmaQoKIyBkYXRhYmFzZQpta2RpciBwdgpjYXQgPDxFT0YgPiBwdi9wdi55YW1sCmFwaVZlcnNpb246IGFwcHMvdjEKa2luZDogRGVwbG95bWVudAptZXRhZGF0YToKICBuYW1lOiBwb3N0Z3JlcwpzcGVjOgogIHJlcGxpY2FzOiAxCiAgc2VsZWN0b3I6CiAgICBtYXRjaExhYmVsczoKICAgICAgYXBwOiBwb3N0Z3JlcwogIHRlbXBsYXRlOgogICAgbWV0YWRhdGE6CiAgICAgIGxhYmVsczoKICAgICAgICBhcHA6IHBvc3RncmVzCiAgICBzcGVjOgogICAgICB2b2x1bWVzOgogICAgICAgIC0gbmFtZTogcG9zdGdyZXMtcHYtc3RvcmFnZQogICAgICAgICAgcGVyc2lzdGVudFZvbHVtZUNsYWltOgogICAgICAgICAgICBjbGFpbU5hbWU6IHBvc3RncmVzLXB2LWNsYWltCiAgICAgIGNvbnRhaW5lcnM6CiAgICAgICAgLSBuYW1lOiBwb3N0Z3JlcwogICAgICAgICAgaW1hZ2U6IHBvc3RncmVzOjEzLjQKICAgICAgICAgIGltYWdlUHVsbFBvbGljeTogSWZOb3RQcmVzZW50CiAgICAgICAgICBwb3J0czoKICAgICAgICAgICAgLSBjb250YWluZXJQb3J0OiA1NDMyCiAgICAgICAgICBlbnY6CiAgICAgICAgICAgIC0gbmFtZTogUE9TVEdSRVNfVVNFUgogICAgICAgICAgICAgIHZhbHVlOiBkaXJla3RpdgogICAgICAgICAgICAtIG5hbWU6IFBPU1RHUkVTX0RCCiAgICAgICAgICAgICAgdmFsdWU6IGRpcmVrdGl2CiAgICAgICAgICAgIC0gbmFtZTogUE9TVEdSRVNfUEFTU1dPUkQKICAgICAgICAgICAgICB2YWx1ZTogZGlyZWt0aXZkaXJla3RpdgogICAgICAgICAgICAtIG5hbWU6IFBHREFUQQogICAgICAgICAgICAgIHZhbHVlOiAvdmFyL2xpYi9wb3N0Z3Jlc3FsL2RhdGEvcGdkYXRhCiAgICAgICAgICB2b2x1bWVNb3VudHM6CiAgICAgICAgICAgIC0gbW91bnRQYXRoOiAvdmFyL2xpYi9wb3N0Z3Jlc3FsL2RhdGEKICAgICAgICAgICAgICBuYW1lOiBwb3N0Z3Jlcy1wdi1zdG9yYWdlCkVPRgoKY2F0IDw8RU9GID4gcHYvc3RvcmFnZS55YW1sCmFwaVZlcnNpb246IHYxCmtpbmQ6IFBlcnNpc3RlbnRWb2x1bWUKbWV0YWRhdGE6CiAgbmFtZTogcG9zdGdyZXMtcHYtdm9sdW1lCnNwZWM6CiAgc3RvcmFnZUNsYXNzTmFtZTogbG9jYWwtcGF0aAogIGNhcGFjaXR5OgogICAgc3RvcmFnZTogMUdpCiAgYWNjZXNzTW9kZXM6CiAgICAtIFJlYWRXcml0ZU9uY2UKICBob3N0UGF0aDoKICAgIHBhdGg6ICIvdG1wL3BnZGF0YSIKLS0tCmFwaVZlcnNpb246IHYxCmtpbmQ6IFBlcnNpc3RlbnRWb2x1bWVDbGFpbQptZXRhZGF0YToKICBuYW1lOiBwb3N0Z3Jlcy1wdi1jbGFpbQpzcGVjOgogIHN0b3JhZ2VDbGFzc05hbWU6IGxvY2FsLXBhdGgKICBhY2Nlc3NNb2RlczoKICAgIC0gUmVhZFdyaXRlT25jZQogIHJlc291cmNlczoKICAgIHJlcXVlc3RzOgogICAgICBzdG9yYWdlOiAxR2kKLS0tCmFwaVZlcnNpb246IHYxCmtpbmQ6IFNlcnZpY2UKbWV0YWRhdGE6CiAgbmFtZTogcG9zdGdyZXMKICBsYWJlbHM6CiAgICBhcHA6IHBvc3RncmVzCnNwZWM6CiAgdHlwZTogQ2x1c3RlcklQCiAgcG9ydHM6CiAgIC0gcG9ydDogNTQzMgogIHNlbGVjdG9yOgogICAgYXBwOiBwb3N0Z3JlcwpFT0YKCmt1YmVjdGwgYXBwbHkgLWYgcHYKCiMgZG9ja2VyIHJlZ2lzdHJ5Cm1rZGlyIHJlZ2lzdHJ5CgpjYXQgPDxFT0YgPiByZWdpc3RyeS9yZWdpc3RyeS55YW1sCmFwaVZlcnNpb246IHYxCmtpbmQ6IE5hbWVzcGFjZQptZXRhZGF0YToKICBuYW1lOiByZWdpc3RyeS1ucwotLS0KYXBpVmVyc2lvbjogdjEKa2luZDogU2VydmljZUFjY291bnQKbWV0YWRhdGE6CiAgbmFtZTogcmVnaXN0cnktc2EKICBuYW1lc3BhY2U6IHJlZ2lzdHJ5LW5zCi0tLQphcGlWZXJzaW9uOiB2MQpraW5kOiBQb2QKbWV0YWRhdGE6CiAgbmFtZTogZG9ja2VyLXJlZ2lzdHJ5LXBvZAogIG5hbWVzcGFjZTogcmVnaXN0cnktbnMKICBsYWJlbHM6CiAgICBhcHA6IHJlZ2lzdHJ5CnNwZWM6CiAgc2VydmljZUFjY291bnROYW1lOiByZWdpc3RyeS1zYQogIGNvbnRhaW5lcnM6CiAgLSBuYW1lOiByZWdpc3RyeQogICAgaW1hZ2U6IHJlZ2lzdHJ5OjIuNy4xCi0tLQphcGlWZXJzaW9uOiB2MQpraW5kOiBTZXJ2aWNlCm1ldGFkYXRhOgogIG5hbWU6IGRvY2tlci1yZWdpc3RyeQogIG5hbWVzcGFjZTogcmVnaXN0cnktbnMKc3BlYzoKICB0eXBlOiBOb2RlUG9ydAogIHNlbGVjdG9yOgogICAgYXBwOiByZWdpc3RyeQogIHBvcnRzOgogIC0gcG9ydDogNTAwMAogICAgdGFyZ2V0UG9ydDogNTAwMAogICAgbm9kZVBvcnQ6IDMxMjEyCkVPRgoKa3ViZWN0bCBhcHBseSAtZiByZWdpc3RyeQoKIyB3YWl0aW5nIGZvciBkYgp3aGlsZSAhIGt1YmVjdGwgd2FpdCAtLWZvcj1jb25kaXRpb249cmVhZHkgcG9kIC1sIGFwcD1wb3N0Z3JlcwpkbwogICAgZWNobyAid2FpdGluZyBmb3IgZGF0YWJhc2UiCiAgICBzbGVlcCAxCmRvbmUKCgojIGRpcmVrdGl2CmNhdCA8PEVPRiA+IGRpcmVrdGl2LnlhbWwKcHVsbFBvbGljeTogSWZOb3RQcmVzZW50CmRlYnVnOiAidHJ1ZSIKCmV2ZW50aW5nOgogIGVuYWJsZWQ6IHRydWUKCnNlY3JldHM6CiAgaW1hZ2U6ICIkMSIKICB0YWc6ICIkMyIKZmxvdzoKICBpbWFnZTogIiQxIgogIGRiaW1hZ2U6ICIkMSIKICB0YWc6ICIkMyIKdWk6CiAgaW1hZ2U6ICIkMiIKICB0YWc6ICIkMyIKYXBpOgogIGltYWdlOiAiJDEiCiAgdGFnOiAiJDMiCmZ1bmN0aW9uczoKICBuYW1lc3BhY2U6IGRpcmVrdGl2LXNlcnZpY2VzLWRpcmVrdGl2CiAgaW1hZ2U6ICIkMSIKICB0YWc6ICIkMyIKICBzaWRlY2FyOiAiJDEiCiAgaW5pdFBvZEltYWdlOiAiZGlyZWt0aXYvaW5pdC1wb2QiCiQoaWYgWyAtbiAiJHtIVFRQU19QUk9YWSsxfSIgXTsgdGhlbgogIGVjaG8gIiAgaHR0cF9wcm94eTogJHtIVFRQX1BST1hZfSIKICBlY2hvICIgIGh0dHBzX3Byb3h5OiAke0hUVFBTX1BST1hZfSIKICBlY2hvICIgIG5vX3Byb3h5OiAke05PX1BST1hZfSIKZmkpCgpkYXRhYmFzZToKICAjIC0tIGRhdGFiYXNlIGhvc3QKICBob3N0OiAicG9zdGdyZXMiCiAgIyAtLSBkYXRhYmFzZSBwb3J0CiAgcG9ydDogNTQzMgogICMgLS0gZGF0YWJhc2UgdXNlcgogIHVzZXI6ICJkaXJla3RpdiIKICAjIC0tIGRhdGFiYXNlIHBhc3N3b3JkCiAgcGFzc3dvcmQ6ICJkaXJla3RpdmRpcmVrdGl2IgogICMgLS0gZGF0YWJhc2UgbmFtZSwgYXV0byBjcmVhdGVkIGlmIGl0IGRvZXMgbm90IGV4aXN0CiAgbmFtZTogImRpcmVrdGl2IgogICMgLS0gc3NsbW9kZSBmb3IgZGF0YWJhc2UKICBzc2xtb2RlOiBkaXNhYmxlCgokKGlmIFsgLW4gIiR7SFRUUFNfUFJPWFkrMX0iIF07IHRoZW4KICBlY2hvICJodHRwX3Byb3h5OiAke0hUVFBfUFJPWFl9IgogIGVjaG8gImh0dHBzX3Byb3h5OiAke0hUVFBTX1BST1hZfSIKICBlY2hvICJub19wcm94eTogJHtOT19QUk9YWX0iCmZpKQoKJChpZiBbIC1uICIke0FQSUtFWSsxfSIgXTsgdGhlbgogIGVjaG8gImFwaWtleTogXCIke0FQSUtFWX1cIiIKZmkpCkVPRgoKZ2l0IGNsb25lIC1iIG9uZS1iaW5hcnkgaHR0cHM6Ly9naXRodWIuY29tL2RpcmVrdGl2L2RpcmVrdGl2LWNoYXJ0cy5naXQKCmNkIGBwd2RgL2RpcmVrdGl2LWNoYXJ0cy9jaGFydHMvZGlyZWt0aXYgJiYgXAogICAgaGVsbSByZXBvIGFkZCBkaXJla3RpdiBodHRwczovL2NoYXJ0LmRpcmVrdGl2LmlvICYmIFwKICAgIGhlbG0gcmVwbyBhZGQgaW5ncmVzcy1uZ2lueCBodHRwczovL2t1YmVybmV0ZXMuZ2l0aHViLmlvL2luZ3Jlc3MtbmdpbnggJiYgXAogICAgaGVsbSByZXBvIGFkZCBwcm9tZXRoZXVzIGh0dHBzOi8vcHJvbWV0aGV1cy1jb21tdW5pdHkuZ2l0aHViLmlvL2hlbG0tY2hhcnRzICYmIFwKICAgIGhlbG0gcmVwbyBsaXN0ICYmIFwKICAgIGhlbG0gZGVwZW5kZW5jeSBidWlsZCAmJiBcIAogICAgS1VCRUNPTkZJRz0vZXRjL3JhbmNoZXIvazNzL2szcy55YW1sIGhlbG0gaW5zdGFsbCAtZiAvZGlyZWt0aXYueWFtbCBkaXJla3RpdiAuCgojIGV2ZW50aW5nCmt1YmVjdGwgY3JlYXRlIG5zIGtuYXRpdmUtZXZlbnRpbmcKCmNhdCA8PEVPRiA+IGV2ZW50aW5nLnlhbWwKYXBpVmVyc2lvbjogb3BlcmF0b3Iua25hdGl2ZS5kZXYvdjFiZXRhMQpraW5kOiBLbmF0aXZlRXZlbnRpbmcKbWV0YWRhdGE6CiAgbmFtZToga25hdGl2ZS1ldmVudGluZwogIG5hbWVzcGFjZToga25hdGl2ZS1ldmVudGluZwpFT0YKCmt1YmVjdGwgYXBwbHkgLWYgZXZlbnRpbmcueWFtbAoKIyBjb250b3VyCmt1YmVjdGwgYXBwbHkgLS1maWxlbmFtZSBodHRwczovL2dpdGh1Yi5jb20va25hdGl2ZS9uZXQtY29udG91ci9yZWxlYXNlcy9kb3dubG9hZC9rbmF0aXZlLXYxLjkuMy9jb250b3VyLnlhbWwKa3ViZWN0bCBkZWxldGUgbnMgY29udG91ci1leHRlcm5hbCAmCgojIHdhaXRpbmcgZm9yIGRpcmVrdGl2CndoaWxlICEga3ViZWN0bCB3YWl0IC0tZm9yPWNvbmRpdGlvbj1yZWFkeSBwb2QgLWwgYXBwLmt1YmVybmV0ZXMuaW8vbmFtZT1kaXJla3RpdgpkbwogICAgZWNobyAid2FpdGluZyBmb3IgZGlyZWt0aXYiCiAgICBzbGVlcCAxCmRvbmUKCm49MAp1bnRpbCBbICIkbiIgLWdlIDI0IF0KZG8KICAgY3VybCAtWCBQVVQgaHR0cDovL2xvY2FsaG9zdC9hcGkvbmFtZXNwYWNlcy9leGFtcGxlcyBcCiAgICAgLUggIkNvbnRlbnQtVHlwZTogYXBwbGljYXRpb24vanNvbiIgXAogICAgIC1IICJEaXJla3Rpdi1Ub2tlbjogJHtBUElLRVl9IiBcCiAgICAgLS13cml0ZS1vdXQgIiV7aHR0cF9jb2RlfSIgXAogICAgIC1mIFwKICAgICAtZCAneyAidXJsIjogImh0dHBzOi8vZ2l0aHViLmNvbS9kaXJla3Rpdi9kaXJla3Rpdi1leGFtcGxlcy5naXQiLCAicmVmIjogIm1haW4iIH0nICYmIGJyZWFrCiAgIG49JCgobisxKSkKICAgc2xlZXAgMTAKZG9uZQoKCgo=
  path: /home/install.sh
  permissions: '0755'