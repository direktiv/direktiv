# Postgres Database

The postgres database is installed via the [Percona operator](https://github.com/percona/percona-helm-charts/). 

## Variables

**DB_REPLICA_COUNT**: Sets the number of replicas of the database instances (Default: 1)

**DB_STORAGE**: Sets the storage size of the database. (Default 1Gi)

**DB_BOUNCER_COUNT**: Number of pgbouncer instances (Default: 1) 

**DB_BACKUP_SCHEDULE**: Schedule for backups to run (Default: 0 0 * * 6)

**DB_BACKUP_RETENTION**: Number of backups to retain (Default: 4)

**DB_BACKUP_STORAGE**: Sets the storage size for the database backups. (Default 1Gi)

**DB_ADDITIONAL_USERS**: Create additional users and databases. (Default: "")

**DB_BACKUP_VALUE**: YAML representation of the backup configuration. [zarf-config-example.yaml](zarf-config-example.yaml) provides an example. 

### S3

Backup to S3 needs an additionl configuration which can be done via a `zarf-config.yaml` file. [zarf-config-example.yaml](zarf-config-example.yaml) provides an example. There are two configurations required. The first one is the S3 backend which looks like:

```
s3:
    bucket: direktiv-backup
    endpoint: "https://eu-central-1.linodeobjects.com"
    region: "US"
```

The second one is a Kubernetes secret which is generated by default with dummy values. It contains the S3 secret as `DB_BACKUP_S3_SECRET` and the S3 key as `DB_BACKUP_S3_KEY`.


**DB_BACKUP_S3_KEY**: S3 Key

**DB_BACKUP_S3_SECRET**: S3 Secret
