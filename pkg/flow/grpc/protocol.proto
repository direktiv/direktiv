syntax = "proto3";

package direktiv_flow;

option go_package = "github.com/direktiv/direktiv/pkg/flow/grpc";

import "google/protobuf/empty.proto";

import "pkg/flow/grpc/namespaces.proto";
import "pkg/flow/grpc/variables.proto";
import "pkg/flow/grpc/instances.proto";
import "pkg/flow/grpc/internal.proto";
import "pkg/flow/grpc/cloudevent.proto";
import "pkg/flow/grpc/util.proto";
// import "pkg/flow/grpc/eventing.proto";

import "pkg/flow/grpc/mirror.proto";

service Flow {
	// namespaces.
	rpc Namespace (NamespaceRequest) returns (NamespaceResponse) {}
	rpc Namespaces (NamespacesRequest) returns (NamespacesResponse) {}
	rpc NamespacesStream (NamespacesRequest) returns (stream NamespacesResponse) {}
	rpc CreateNamespace (CreateNamespaceRequest) returns (CreateNamespaceResponse) {}
	rpc DeleteNamespace (DeleteNamespaceRequest) returns (google.protobuf.Empty) {}

	// instances.
	rpc Instance (InstanceRequest) returns (InstanceResponse) {}
	rpc InstanceStream (InstanceRequest) returns (stream InstanceResponse) {}
	rpc Instances (InstancesRequest) returns (InstancesResponse) {}
	rpc InstancesStream (InstancesRequest) returns (stream InstancesResponse) {}
	rpc InstanceInput (InstanceInputRequest) returns (InstanceInputResponse) {}
	rpc InstanceOutput (InstanceOutputRequest) returns (InstanceOutputResponse) {}
	rpc InstanceMetadata (InstanceMetadataRequest) returns (InstanceMetadataResponse) {}


	// workflows.
	rpc StartWorkflow (StartWorkflowRequest) returns (StartWorkflowResponse) {}
	rpc AwaitWorkflow (AwaitWorkflowRequest) returns (stream AwaitWorkflowResponse) {}
	rpc CancelInstance (CancelInstanceRequest) returns (google.protobuf.Empty) {}
	rpc BroadcastCloudevent (BroadcastCloudeventRequest) returns (google.protobuf.Empty) {}

	// variables.
	rpc NamespaceVariable (NamespaceVariableRequest) returns (NamespaceVariableResponse) {}
	rpc SetNamespaceVariableParcels (stream SetNamespaceVariableRequest) returns (SetNamespaceVariableResponse) {}
	rpc WorkflowVariable (WorkflowVariableRequest) returns (WorkflowVariableResponse) {}
	rpc SetWorkflowVariableParcels (stream SetWorkflowVariableRequest) returns (SetWorkflowVariableResponse) {}
	rpc InstanceVariable (InstanceVariableRequest) returns (InstanceVariableResponse) {}
	rpc SetInstanceVariableParcels (stream SetInstanceVariableRequest) returns (SetInstanceVariableResponse) {}

	//
	rpc JQ (JQRequest) returns (JQResponse) {}
	rpc WorkflowMetrics (WorkflowMetricsRequest) returns (WorkflowMetricsResponse) {}

	// events.
	rpc EventListeners (EventListenersRequest) returns (EventListenersResponse) {} 
	rpc EventListenersStream (EventListenersRequest) returns (stream EventListenersResponse) {}
	rpc EventHistory (EventHistoryRequest) returns (EventHistoryResponse) {}
	rpc EventHistoryStream (EventHistoryRequest) returns (stream EventHistoryResponse) {}
	rpc HistoricalEvent (HistoricalEventRequest) returns (HistoricalEventResponse) {}
	rpc ReplayEvent (ReplayEventRequest) returns (google.protobuf.Empty) {}

	// mirrors.
	rpc CreateNamespaceMirror (CreateNamespaceMirrorRequest) returns (CreateNamespaceResponse) {}
	rpc UpdateMirrorSettings (UpdateMirrorSettingsRequest) returns (google.protobuf.Empty) {}
	rpc SoftSyncMirror(SoftSyncMirrorRequest) returns (google.protobuf.Empty) {}
	rpc HardSyncMirror(HardSyncMirrorRequest) returns (google.protobuf.Empty) {}
	rpc MirrorInfo(MirrorInfoRequest) returns (MirrorInfoResponse) {}
	rpc MirrorInfoStream(MirrorInfoRequest) returns (stream MirrorInfoResponse) {}
	rpc CancelMirrorActivity (CancelMirrorActivityRequest) returns (google.protobuf.Empty) {}

	//
	rpc NamespaceLint (NamespaceLintRequest) returns (NamespaceLintResponse) {}
}

service Internal {
 	rpc ReportActionResults (ReportActionResultsRequest) returns (google.protobuf.Empty) {}
 	rpc ActionLog(ActionLogRequest) returns (google.protobuf.Empty) {}

	rpc NamespaceVariableParcels (VariableInternalRequest) returns (stream VariableInternalResponse) {}
	rpc SetNamespaceVariableParcels (stream SetVariableInternalRequest) returns (SetVariableInternalResponse) {}
	rpc WorkflowVariableParcels (VariableInternalRequest) returns (stream VariableInternalResponse) {}
	rpc SetWorkflowVariableParcels (stream SetVariableInternalRequest) returns (SetVariableInternalResponse) {}
	rpc InstanceVariableParcels (VariableInternalRequest) returns (stream VariableInternalResponse) {}
	rpc SetInstanceVariableParcels (stream SetVariableInternalRequest) returns (SetVariableInternalResponse) {}
	rpc FileVariableParcels (VariableInternalRequest) returns (stream VariableInternalResponse) {}
}

// Todo: Yassir, delete this entirely in cycle6.
//service Eventing {
//	rpc RequestEvents (EventingRequest) returns (stream CloudEvent) {}
//}
